package main

import (
	"strings"
	"testing"
)

func TestGCMC(t *testing.T) {
	g := gcmc()
	got := strings.Split(g.String(), "\n")
	want := strings.Split(gcmcOut, "\n")

	if len(got) != len(want) {
		t.Errorf("gcmc = %v lines, want %v", len(got), len(want))
	}

	for i, line := range got {
		if i == 1 {
			continue
		}
		if i < len(want) && line != want[i] {
			t.Fatalf("gcmc line #%v:\n%v\nwant:\n%v", i+1, line, want[i])
		}
	}
}

var gcmcOut = `(go-gcode compiled code, do not change)
(2021-09-11 08:33:05)
(-- prologue begin --)
G17 ( Use XY plane )
G21 ( Use mm )
G40 ( Cancel cutter radius compensation )
G49 ( Cancel tool length compensation )
G54 ( Default coordinate system )
G80 ( Cancel canned cycle )
G90 ( Use absolute distance mode )
G94 ( Units Per Minute feed rate mode )
G64 ( Enable path blending for best speed )
(-- prologue end --)
(-- feed        250 --)
(-- origin      [0 0 5 1] --)
(-- touchz      -1 --)
(-- safez       5 --)
(-- predrillz   -4 --)
(-- toolwidth   3 --)
(-- toolwidth/2 1.5 --)
F250.00000000
G0 X0.00000000 Y0.00000000 Z5.00000000
G0 X6.98500000 Y3.93700000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y14.09700000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y37.71900000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y45.33900000
G1 Z-1.00000000
G1 Z5.00000000
G0 X22.73300000 Y8.50900000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y40.76700000
G1 Z-1.00000000
G1 Z5.00000000
G0 X74.16800000 Y8.50900000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y40.76700000
G1 Z-1.00000000
G1 Z5.00000000
G0 X125.60300000 Y8.50900000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y40.76700000
G1 Z-1.00000000
G1 Z5.00000000
G0 X177.03800000 Y8.50900000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y40.76700000
G1 Z-1.00000000
G1 Z5.00000000
G0 X192.40500000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y30.48000000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y24.63800000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y18.79600000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y8.50900000
G1 Z-1.00000000
G1 Z5.00000000
G0 X164.97300000 Y2.03200000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y47.24400000
G1 Z-1.00000000
G1 Z5.00000000
G0 X60.07100000
G1 Z-1.00000000
G1 Z5.00000000
G0 Y2.03200000
G1 Z-1.00000000
G1 Z5.00000000
(-- putpad at offset=[39.623999999999995 2.032 0 1] --)
G0 X41.12400000 Y1.62700000
G1 Z-1.00000000
(-- tracepath at Z=-1 --)
G1 Y2.43700000
G1 X52.09400000
G1 Y1.62700000
G1 X41.12400000
(-- tracepath end --)
G1 Z-2.00000000
(-- tracepath at Z=-2 --)
G1 Y2.43700000
G1 X52.09400000
G1 Y1.62700000
G1 X41.12400000
(-- tracepath end --)
G1 Z-1.00000000
G0 X40.89400000 Y2.03200000
G1 Z-4.00000000
G1 Z5.00000000
(-- putpad at offset=[39.623999999999995 47.244 0 1] --)
G0 X41.12400000 Y46.83900000
G1 Z-1.00000000
(-- tracepath at Z=-1 --)
G1 Y47.64900000
G1 X52.09400000
G1 Y46.83900000
G1 X41.12400000
(-- tracepath end --)
G1 Z-2.00000000
(-- tracepath at Z=-2 --)
G1 Y47.64900000
G1 X52.09400000
G1 Y46.83900000
G1 X41.12400000
(-- tracepath end --)
G1 Z-1.00000000
G0 X40.89400000 Y47.24400000
G1 Z-4.00000000
G1 Z5.00000000
G0 X7.11200000 Y27.43200000
G1 Z-1.00000000
(-- tracepath at Z=-1 --)
G1 X47.49800000 Y31.87700000
G1 X50.54600000 Y34.92500000
G1 X60.98400000
G1 Y30.09900000
G1 X50.54600000
G1 X47.49800000 Y29.33700000
G1 X11.93800000 Y24.89200000
G1 Y24.38400000
G1 X47.49800000 Y19.93900000
G1 X50.54600000 Y19.17700000
G1 X60.98400000
G1 Y14.35100000
G1 X50.54600000
G1 X47.49800000 Y17.39900000
G1 X7.11200000 Y21.84400000
G1 Y27.43200000
(-- tracepath end --)
G1 X8.60156520 Y26.09738563
(-- tracepath at Z=-1 --)
G1 X48.36344400 Y30.07394518
G1 X51.31136686 Y33.07724093
G1 X59.56978644 Y33.51078644
G1 Y31.51321356
G1 X50.30163347 Y32.08401511
G1 X47.13076193 Y31.30299496
G1 X10.43864365 Y26.21560513
G1 Y23.06039487
G1 X47.13076193 Y17.97300504
G1 X50.30163347 Y17.19198489
G1 X59.56978644 Y17.76278644
G1 Y15.76521356
G1 X51.31136686 Y16.19875907
G1 X48.36344400 Y19.20205482
G1 X8.60156520 Y23.17861437
G1 Y26.09738563
(-- tracepath end --)
G1 X7.11200000 Y27.43200000
G1 Z-2.00000000
(-- tracepath at Z=-2 --)
G1 X47.49800000 Y31.87700000
G1 X50.54600000 Y34.92500000
G1 X60.98400000
G1 Y30.09900000
G1 X50.54600000
G1 X47.49800000 Y29.33700000
G1 X11.93800000 Y24.89200000
G1 Y24.38400000
G1 X47.49800000 Y19.93900000
G1 X50.54600000 Y19.17700000
G1 X60.98400000
G1 Y14.35100000
G1 X50.54600000
G1 X47.49800000 Y17.39900000
G1 X7.11200000 Y21.84400000
G1 Y27.43200000
(-- tracepath end --)
G1 X8.60156520 Y26.09738563
(-- tracepath at Z=-2 --)
G1 X48.36344400 Y30.07394518
G1 X51.31136686 Y33.07724093
G1 X59.56978644 Y33.51078644
G1 Y31.51321356
G1 X50.30163347 Y32.08401511
G1 X47.13076193 Y31.30299496
G1 X10.43864365 Y26.21560513
G1 Y23.06039487
G1 X47.13076193 Y17.97300504
G1 X50.30163347 Y17.19198489
G1 X59.56978644 Y17.76278644
G1 Y15.76521356
G1 X51.31136686 Y16.19875907
G1 X48.36344400 Y19.20205482
G1 X8.60156520 Y23.17861437
G1 Y26.09738563
(-- tracepath end --)
G1 Z5.00000000
G0 X61.21400000 Y14.85900000
G1 Z-4.00000000
G1 Z5.00000000
G0 Y18.66900000
G1 Z-4.00000000
G1 Z5.00000000
G0 Y30.60700000
G1 Z-4.00000000
G1 Z5.00000000
G0 Y34.41700000
G1 Z-4.00000000
G1 Z5.00000000
(-- putpad at offset=[168.148 24.637999999999998 0 1] --)
G0 X169.64800000 Y24.23300000
G1 Z-1.00000000
(-- tracepath at Z=-1 --)
G1 Y25.04300000
G1 X180.61800000
G1 Y24.23300000
G1 X169.64800000
(-- tracepath end --)
G1 Z-2.00000000
(-- tracepath at Z=-2 --)
G1 Y25.04300000
G1 X180.61800000
G1 Y24.23300000
G1 X169.64800000
(-- tracepath end --)
G1 Z-1.00000000
G0 X169.41800000 Y24.63800000
G1 Z-4.00000000
G1 Z5.00000000
G0 X0.00000000 Y0.00000000
(-- epilogue begin --)
M30 (-- epilogue end --)
`
