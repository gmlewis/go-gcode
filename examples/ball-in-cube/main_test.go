package main

import (
	"strings"
	"testing"
)

func TestGCMC(t *testing.T) {
	g := gcmc()
	got := strings.Split(g.String(), "\n")
	want := strings.Split(gcmcOut, "\n")

	if len(got) != len(want) {
		t.Errorf("gcmc = %v lines, want %v", len(got), len(want))
	}

	for i, line := range got {
		if i == 1 {
			continue
		}
		if i < len(want) && line != want[i] {
			t.Fatalf("gcmc line #%v:\n%v\nwant:\n%v", i+1, line, want[i])
		}
	}
}

var gcmcOut = `(go-gcode compiled code, do not change)
(2021-09-11 08:33:05)
(-- prologue begin --)
G17 ( Use XY plane )
G21 ( Use mm )
G40 ( Cancel cutter radius compensation )
G49 ( Cancel tool length compensation )
G54 ( Default coordinate system )
G80 ( Cancel canned cycle )
G90 ( Use absolute distance mode )
G94 ( Units Per Minute feed rate mode )
G64 ( Enable path blending for best speed )
(-- prologue end --)
F250.00000000
G1 X0.00000000 Y0.00000000
F75.00000000
G1 X1.63315304 Y1.63315304
G1 Z-0.14261000
F100.00000000
G18
G2 X-1.63315304 Y1.63315304 I-1.63315304 K-37.29831170
G19
G3 X-1.63315304 Y-1.63315304 J-1.63315304 K-37.29831170
G18
G3 X1.63315304 Y-1.63315304 I1.63315304 K-37.29831170
G19
G2 X1.63315304 Y1.63315304 J1.63315304 K-37.29831170
F75.00000000
G1 X3.25387681 Y3.25387681
G1 Z-0.56935467
F100.00000000
G18
G2 X-3.25387681 Y3.25387681 I-3.25387681 K-36.76358835
G19
G3 X-3.25387681 Y-3.25387681 J-3.25387681 K-36.76358835
G18
G3 X3.25387681 Y-3.25387681 I3.25387681 K-36.76358835
G19
G2 X3.25387681 Y3.25387681 J3.25387681 K-36.76358835
F75.00000000
G1 X4.84983660 Y4.84983660
G1 Z-1.27698620
F100.00000000
G18
G2 X-4.84983660 Y4.84983660 I-4.84983660 K-35.87332470
G19
G3 X-4.84983660 Y-4.84983660 J-4.84983660 K-35.87332470
G18
G3 X4.84983660 Y-4.84983660 I4.84983660 K-35.87332470
G19
G2 X4.84983660 Y4.84983660 J4.84983660 K-35.87332470
F75.00000000
G1 X6.40888621 Y6.40888621
G1 Z-2.26011911
F100.00000000
G18
G2 X-6.40888621 Y6.40888621 I-6.40888621 K-34.62846932
G19
G3 X-6.40888621 Y-6.40888621 J-6.40888621 K-34.62846932
G18
G3 X6.40888621 Y-6.40888621 I6.40888621 K-34.62846932
G19
G2 X6.40888621 Y6.40888621 J6.40888621 K-34.62846932
F75.00000000
G1 X7.91916033 Y7.91916033
G1 Z-3.51127115
F100.00000000
G18
G2 X-7.91916033 Y7.91916033 I-7.91916033 K-33.02929758
G19
G3 X-7.91916033 Y-7.91916033 J-7.91916033 K-33.02929758
G18
G3 X7.91916033 Y-7.91916033 I7.91916033 K-33.02929758
G19
G2 X7.91916033 Y7.91916033 J7.91916033 K-33.02929758
F75.00000000
G1 X9.36916485 Y9.36916485
G1 Z-5.02092031
F100.00000000
G18
G2 X-9.36916485 Y9.36916485 I-9.36916485 K-31.07400441
G19
G3 X-9.36916485 Y-9.36916485 J-9.36916485 K-31.07400441
G18
G3 X9.36916485 Y-9.36916485 I9.36916485 K-31.07400441
G19
G2 X9.36916485 Y9.36916485 J9.36916485 K-31.07400441
F75.00000000
G1 X10.74786437 Y10.74786437
G1 Z-6.77757724
F100.00000000
G18
G2 X-10.74786437 Y10.74786437 I-10.74786437 K-28.75616555
G19
G3 X-10.74786437 Y-10.74786437 J-10.74786437 K-28.75616555
G18
G3 X10.74786437 Y-10.74786437 I10.74786437 K-28.75616555
G19
G2 X10.74786437 Y10.74786437 J10.74786437 K-28.75616555
F75.00000000
G1 X12.04476616 Y12.04476616
G1 Z-8.76787272
F100.00000000
G18
G2 X-12.04476616 Y12.04476616 I-12.04476616 K-26.05989334
G19
G3 X-12.04476616 Y-12.04476616 J-12.04476616 K-26.05989334
G18
G3 X12.04476616 Y-12.04476616 I12.04476616 K-26.05989334
G19
G2 X12.04476616 Y12.04476616 J12.04476616 K-26.05989334
F75.00000000
G1 X13.25000000 Y13.25000000
G1 Z-10.97665940
F100.00000000
G18
G2 X-13.25000000 Y13.25000000 I-13.25000000 K-22.94967320
G19
G3 X-13.25000000 Y-13.25000000 J-13.25000000 K-22.94967320
G18
G3 X13.25000000 Y-13.25000000 I13.25000000 K-22.94967320
G19
G2 X13.25000000 Y13.25000000 J13.25000000 K-22.94967320
F75.00000000
G1 X14.35439334 Y14.35439334
G1 Z-13.38712709
F100.00000000
G18
G2 X-14.35439334 Y14.35439334 I-14.35439334 K-19.34572198
G19
G3 X-14.35439334 Y-14.35439334 J-14.35439334 K-19.34572198
G18
G3 X14.35439334 Y-14.35439334 I14.35439334 K-19.34572198
G19
G2 X14.35439334 Y14.35439334 J14.35439334 K-19.34572198
G1 Z10.00000000
F75.00000000
G0 X20.50000000 Y20.50000000
G1 Z-1.50000000
G1 X-20.50000000
G1 Y-20.50000000
G1 X20.50000000
G1 Y20.50000000
G1 Z-3.00000000
G1 X-20.50000000
G1 Y-20.50000000
G1 X20.50000000
G1 Y20.50000000
G1 Z10.00000000
G0 X29.50000000 Y29.50000000
G1 Z-1.50000000
G1 X-29.50000000
G1 Y-29.50000000
G1 X29.50000000
G1 Y29.50000000
G1 Z-3.00000000
G1 X-29.50000000
G1 Y-29.50000000
G1 X29.50000000
G1 Y29.50000000
G1 Z10.00000000
G0 X0.00000000 Y0.00000000
(-- epilogue begin --)
M30 (-- epilogue end --)
`
